(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{157:function(e,t,n){e.exports=n(306)},306:function(e,t,n){"use strict";n.r(t);var r=n(1),a=n.n(r),o=n(5),i=n.n(o),c=n(152),l=n(47),s=n.n(l),u=n(85),p=n(105),d=n(153),h=n(139),f=n(140),m=n(154),y=n(141),k=n(155),v=(n(163),n(61)),w=n(25),b=n(314),g=n(9),x=n(311),E=n(310),O=n(313),S=n(312),j=n(309),C=n(58),F=n.n(C);function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function N(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(n,!0).forEach(function(t){Object(p.a)(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(n).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}var M=function(e){function t(e){var n;if(Object(h.a)(this,t),(n=Object(m.a)(this,Object(y.a)(t).call(this,e))).bucket={key:"",type:"bucket",url:"".concat(window.location.protocol,"//").concat(window.location.hostname).concat(window.location.port?":"+window.location.port:""),children:[]},n.state={files:[],data:[],seraching:!1,fetching:!1},n.browserUrl="".concat(n.bucket.url).concat(window.location.pathname),n.prefix="",n.onRowClick=function(e,t,n){console.log("Row click",{record:e,index:t,event:n})},n.columns=[{title:"Name",dataIndex:"name",key:"name",width:"50%",render:function(e,t,r){return n.state.searching?a.a.createElement("div",{style:{marginLeft:"5px",display:"block"}},a.a.createElement("span",null,e),a.a.createElement("br",null),a.a.createElement("span",{style:{fontSize:"10px"}},t.key.substr(0,t.key.lastIndexOf("/")))):a.a.createElement("span",{style:{marginLeft:"5px"}},e)}},{title:"Actions",key:"actions",width:"10%",render:function(e,t,r){var o=a.a.createElement(v.a,{title:"Download this ".concat(t.type,": ").concat(t.name)},a.a.createElement(w.a,{icon:"download",shape:"round",onClick:n.handleDownload.bind(null,t)}));return a.a.createElement(w.a.Group,{size:"small"},a.a.createElement(v.a,{title:"Share this ".concat(t.type,": ").concat(t.name)},a.a.createElement(w.a,{icon:"link",shape:"round",onClick:n.handleShare.bind(null,t)})),"file"===t.type?o:"")}},{title:"Last Modified",dataIndex:"modified",key:"modified",width:"20%",render:function(e,t,n){return e?a.a.createElement("div",null,a.a.createElement(b.a,null,F()(e).fromNow()),a.a.createElement("br",null),a.a.createElement("small",null,e)):""}},{title:"Size",dataIndex:"size",key:"size",width:"20%",render:function(e,t,r){var o;if(e){var i="file"===t.type?"geekblue":"";o=a.a.createElement(b.a,{color:i,size:"small"},n.readableFileSize(e))}else o=a.a.createElement("span",null);return o}}],window.location.search){var r=window.location.search.slice(1).split("&").map(function(e){return e.split("=")}).reduce(function(e,t){var n=Object(d.a)(t,2),r=n[0],a=n[1];return N({},e,Object(p.a)({},r,a))},{});"shared"in r&&(n.bucket.key=r.shared)}return n}return Object(k.a)(t,e),Object(f.a)(t,[{key:"componentDidMount",value:function(){var e=this;console.log("ComponentDidMount"),console.log(this.prefix),this.getAsync({prefix:this.bucket.key}).then(function(t){e.setupBucket(t)})}},{key:"setupBucket",value:function(e){this.bucket=N({},this.bucket,{name:this.getNodeValue("Name",e),share:"".concat(this.browserUrl)}),window.document.title=window.document.title+"|"+this.bucket.name,this.processFolder(this.bucket)}},{key:"getAsync",value:function(){var e=Object(u.a)(s.a.mark(function e(t){var n,r;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.request(t);case 2:n=e.sent;case 3:if("true"!==this.getNodeValue("IsTruncated",n)){e.next=11;break}return r=this.getNodeValue("NextMarker",n),e.t0=n,e.next=8,this.request({prefix:t.prefix,marker:r});case 8:n=e.t0+=e.sent,e.next=3;break;case 11:return this.setState(function(e){return e.fetching=!1,e}),e.abrupt("return",n);case 14:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"request",value:function(){var e=Object(u.a)(s.a.mark(function e(t){var n,r,a,o;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(t=N({},t)).prefix="prefix"in t?t.prefix:"",console.log("Request Options",t),(n=[]).push("delimiter=/"),n.push("prefix=".concat(t.prefix)),t.marker&&n.push("marker=".concat(t.marker)),e.prev=7,r=this.bucket.url+"?"+n.join("&"),e.next=11,fetch(r);case 11:return a=e.sent,e.next=14,a.text();case 14:return o=e.sent,e.abrupt("return",(new window.DOMParser).parseFromString(o,"text/xml"));case 18:return e.prev=18,e.t0=e.catch(7),e.abrupt("return",console.error(e.t0));case 21:case"end":return e.stop()}},e,this,[[7,18]])}));return function(t){return e.apply(this,arguments)}}()},{key:"processFolder",value:function(e){var t=this;this.getAsync({prefix:e.key}).then(function(n){var r,a=t.getFilesFromXML(n);(r=e.children).push.apply(r,Object(c.a)(a));var o=!0,i=!1,l=void 0;try{for(var s,u=t.getFoldersFromXML(n)[Symbol.iterator]();!(o=(s=u.next()).done);o=!0){var p=s.value;e.children.push(p),t.processFolder(p)}}catch(d){i=!0,l=d}finally{try{o||null==u.return||u.return()}finally{if(i)throw l}}e.children.sort(t.sorter),t.setState(function(e){return e.data=t.bucket.children,e})})}},{key:"getFilesFromXML",value:function(e){var t=e.getElementsByTagName("Contents"),n=[],r=!0,a=!1,o=void 0;try{for(var i,c=t[Symbol.iterator]();!(r=(i=c.next()).done);r=!0){var l=i.value;n.push(this.parseContents(l))}}catch(s){a=!0,o=s}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return this.setState(function(e){var t;return(t=e.files).push.apply(t,n),console.log("File count:",e.files.len),e}),n}},{key:"getFoldersFromXML",value:function(e){var t=e.getElementsByTagName("CommonPrefixes"),n=[],r=!0,a=!1,o=void 0;try{for(var i,c=t[Symbol.iterator]();!(r=(i=c.next()).done);r=!0){var l=i.value;n.push(this.parseCommonPrefixes(l))}}catch(s){a=!0,o=s}finally{try{r||null==c.return||c.return()}finally{if(a)throw o}}return n}},{key:"getNodeValue",value:function(e,t){return t.getElementsByTagName(e)[0].childNodes[0].nodeValue}},{key:"parseContents",value:function(e){var t={key:this.getNodeValue("Key",e),modified:this.getNodeValue("LastModified",e),size:parseInt(this.getNodeValue("Size",e)),type:"file"};return t.name=t.key.split("/").pop(),t.extension=t.name.split(".").pop(),t.url="".concat(this.bucket.url,"/").concat(t.key),t.share=t.url,t}},{key:"parseCommonPrefixes",value:function(e){var t={type:"folder",size:0,key:this.getNodeValue("Prefix",e),children:[]};return t.name=t.key.replace(/\/$/,"").split("/").pop(),t.share="".concat(this.browserUrl,"?shared=").concat(t.key),t}},{key:"sorter",value:function(e,t){return e.type===t.type?e.name.localeCompare(t.name):"folder"===e.type?-1:1}},{key:"insertOrdered",value:function(e,t){console.log(e,t);for(var n=0,r=t.length;n<r;n++){var a=t[n];if(e.type===a.type&&e.name.localeCompare(a.name)<1){t.splice(n,0,e);break}if("folder"===e.type){t.splice(n,0,e);break}}}},{key:"readableFileSize",value:function(e){if(0===e)return"0.00 B";var t=Math.floor(Math.log(e)/Math.log(1024));return 1*(e/Math.pow(1024,t)).toFixed(2)+" "+["B","kB","MB","GB","TB"][t]}},{key:"fileIcon",value:function(e){var t;switch(e){case"pdf":t="file-pdf";break;case"tar":case"zip":case"gz":t="file-zip";break;case"png":case"jpg":case"jpge":case"tiff":case"bmp":t="file-image";break;default:t="file-text"}return t}},{key:"folderExpandIcon",value:function(e){var t,n="";return"file"===e.record.type?t=this.fileIcon(e.record.extension):e.expanded?(t="folder-open",n="filled"):(t="folder",n="filled"),a.a.createElement(g.a,{type:t,style:{fontSize:"18px"},theme:n})}},{key:"handleShare",value:function(e,t){x.a.info({title:"Share this ".concat(e.type," with others"),content:a.a.createElement("div",null,a.a.createElement("span",null,"Copy the following link:"),a.a.createElement(E.a.Paragraph,{code:!0,copyable:{text:e.share,onCopy:function(e){return O.a.success("Link copied!")}}},e.share))}),t.stopPropagation()}},{key:"handleDownload",value:function(e,t){window.open(e.url),t.preventDefault()}},{key:"handleSearch",value:function(){var e=Object(u.a)(s.a.mark(function e(t){var n,r,a;return s.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:n=this.state.bucket.children,r=!1,(a=t.target.value.toLowerCase())&&a.length>=3&&(r=!0,n=this.state.files.filter(function(e){return e.name.toLowerCase().includes(a)})),this.setState(function(e){return e.searching=r,e.data=n,e});case 5:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return a.a.createElement("div",null,a.a.createElement(E.a.Title,{level:3},"Browsing: ",this.bucket.name,"/",this.bucket.shared),a.a.createElement(v.a,{title:"Search for file. Input at least 3 characaters."},a.a.createElement(S.a,{prefix:a.a.createElement(g.a,{type:"file-search"}),placeholder:"Search...",onChange:this.handleSearch.bind(this)})),a.a.createElement("p",null,this.state.isFetching?"Fetching files...":""),a.a.createElement(j.a,{size:"medium",pagination:!1,expandIcon:this.folderExpandIcon.bind(this),columns:this.columns,dataSource:this.state.data,onRow:function(t,n){return{onClick:e.onRowClick.bind(null,t,n)}},loading:this.state.fetching,expandRowByClick:!0}))}}]),t}(a.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var P=document.querySelectorAll("div.mount-s3-tree");i.a.render(a.a.createElement(M,null),P[0]),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[157,1,2]]]);
//# sourceMappingURL=main.c320668a.chunk.js.map